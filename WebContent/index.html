
 
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
	</script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js">
	</script>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.css"/ > 
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.js"></script>

<style>
body {font-family: Arial, Helvetica, sans-serif;}
form {border: 3px solid #f1f1f1;}

input[type=text], input[type=password] {
    width: 100%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    box-sizing: border-box;
}

button {
    background-color: #4CAF50;
    color: white;
    padding: 14px 20px;
    margin: 8px 0;
    border: none;
    cursor: pointer;
    width: 100%;
}

button:hover {
    opacity: 0.8;
}

.cancelbtn {
    width: auto;
    padding: 10px 18px;
    background-color: #f44336;
}

.imgcontainer {
    text-align: center;
    margin: 24px 0 12px 0;
}

img.avatar {
    width: 40%;
    border-radius: 50%;
}

.container {
    padding: 16px;
}

span.psw {
    float: right;
    padding-top: 16px;
}

/* Change styles for span and cancel button on extra small screens */
@media screen and (max-width: 300px) {
    span.psw {
       display: block;
       float: none;
    }
    .cancelbtn {
       width: 100%;
    }
}
</style>
</head>
<body>
 <br>
 
 <button type="button" class="quickbtn" onclick="order('1','none','pending','NOW','53.34973157,-6.25808716','optional message');">Order Now !</button>
 <input id="datetimepicker" type="text" >
 Message (OPtional):
 <input id="message" type="text" >
  <button type="button" class="quickbtn" onclick="book('1','none','pending','53.34973157,-6.25808716');">Book in the Future</button>
				<div class="col-lg-6">
				<a href="mobile_profile_owner/">
				<div style="text-align:center">
				 <img class="img-circle" height="40px" src="resources/img/"> 
				 <br> Welcome <b> !</div>
				</a>
					<div class="panel panel-info">
						<div class="panel-heading">
							<i class="fa fa-list fa-fw"></i> History
						</div>
						<div class="panel panel-green" style="background:#FFF;"> 
						 <div class="alert alert-warning" > 
				         </div> 
				         <div class="result">  
				         </div>
							 
						</div>
						<button type="button" class="cancelbtn " onclick="goBack()"> Back</button> 
					</div> 
				</div>

</body>
</html>
<script> 

jQuery('#datetimepicker').datetimepicker({
	// timepicker:false,
	 mask:true, // '9999/19/39 29:59' - digit is the maximum possible for a cell
	});
	
//var userid =   '${sessionScope.sessionUser.id}' ;
//var userType = '${sessionScope.sessionUser.type}';

var userid =   "";
var userType = "";
var myBookings = false;
//var mylocation = 'https://www.google.com/maps/search/?api=1&query=28.6139,77.2090';

function drawTable(){

$.get( "http://localhost:8080/projectTest/booking?operation=all", function( data ) { 
	//alert(data['0'].sourceId);
	var bookings = data; 
	var content = '<table id="table-1" class="table table-hover"><thead><tr><th>ID</th><th>Source</th><th>Target</th><th>Time</th><th>Status </th>'+
	'<th>Timestamp </th><th>Location</th><th>Message</th><th class="text-center" style="width: 30%;">Actions</th></tr></thead><tbody>';
	
	if(userType == ""){
	$('.alert').html("List of All bookings from the system");
	 for(i = 0; i< bookings.length; i++){ 
		 content = content+'<tr class="odd gradeX"> <td>'+bookings[i].id+'</td><td>'+bookings[i].sourceId+'</td><td>'+bookings[i].targetId+
		 '</td><td>'+bookings[i].time+'</td><td>'+bookings[i].status+'</td><td>'+bookings[i].timestamp+
		 '</td><td> 5 Best Street , Dublin, Ireland  <br> <a href="https://www.google.com/maps/search/?api=1&query='+bookings[i].location+
				 '" > Navigate </a> </td><td>'+bookings[i].message+'</td><td> - </td>';
	 } 
	}
	
   //this will display for a client
	if(userType == "client"){
		$('.alert').html("Client Side : List of My Bookings");
		 for(i = 0; i< bookings.length; i++){ 
			 if(bookings[i].sourceId == userid)
		   content = content+'<tr class="odd gradeX"> <td>'+bookings[i].id+'</td><td>'+bookings[i].sourceId+'</td><td>'+bookings[i].targetId+
		   '</td><td>'+bookings[i].time+'</td><td>'+bookings[i].status+'</td><td>'+bookings[i].timestamp+
		   '</td><td> 5 Best Street , Dublin, Ireland  </td><td>'+bookings[i].message+'</td><td> <button onclick="cancel('+bookings[i].id+',\''+userType+'\');">Cancel </button>  </td>';
		 } 
	 }
	   //this will display for a care all his bookings
	if(userType == "care" && myBookings == true){
		$('.alert').html("Care Side : List of My Bookings");
		 for(i = 0; i< bookings.length; i++){  
			 if(bookings[i].targetId == userid)
				 content = content+'<tr class="odd gradeX"> <td>'+bookings[i].id+'</td><td>'+bookings[i].sourceId+
				 '</td><td>'+bookings[i].targetId+'</td><td>'+bookings[i].time+'</td><td>'+bookings[i].status+
				 '</td><td>'+bookings[i].timestamp+
				 '</td><td> 5 Best Street , Dublin, Ireland  <br> <a href="https://www.google.com/maps/search/?api=1&query='+bookings[i].location+'" > Navigate </a>  </td><td>'+bookings[i].message+
				 '</td><td> <button onclick="cancel('+bookings[i].id+',\''+userType+'\');">Cancel </button>  </td>';
		 } 
	 }
	    	
	   //this will display for a care all available bookings
	if(userType == "care"  && myBookings == false){
		$('.alert').html("Care Side : List of Pending Bookings");
		 for(i = 0; i< bookings.length; i++){ 
			 if(bookings[i].status == "pending")
				 content = content+'<tr class="odd gradeX"> <td>'+bookings[i].id+'</td><td>'+bookings[i].sourceId+'</td><td>'+bookings[i].targetId+
				 '</td><td>'+bookings[i].time+'</td><td>'+bookings[i].status+'</td><td>'+bookings[i].timestamp+
				 '</td><td>Dublin, Ireland  </td><td>'+bookings[i].message+'</td><td> <button onclick="accept('+bookings[i].id+','+userid+');">Accept </button> </td>';
		 } 
	 }
	  
	 
	  $( ".result" ).html(content+'</tr></tbody></table>');
});
}


function goBack() {
    window.history.back();
}

 function order(sourceId, targetId, status, time, location, message){ 
 var parameters = "operation=add&sourceId="+sourceId+"&targetId="+targetId+"&status="+status+"&time="+time+"&location="+location+"&message="+message; 
	 alert(name+" , You are about to Oreder a Care Professional.  Please Confirm");
	    $.get("http://localhost:8080/projectTest/booking?"+parameters, function(data, status){
	         alert(data); 
	    });
	    $("#msg").text("A Professional Care is on the way");
 } 
 
 function book(sourceId, targetId, status, location){ 
	// alert($('#datetimepicker').val());
	 var parameters = "operation=add&sourceId="+sourceId+"&targetId="+targetId+"&status="+status+"&time="+$('#datetimepicker').val()+"&location="+location+"&message="+$('#message').val(); 
		 alert(name+" , You are about to Oreder a Care Professional.  Please Confirm"); 
		    $.get("http://localhost:8080/projectTest/booking?"+parameters, function(data, status){
		         
		    });
		    $("#msg").text("A Professional Care is on the way");
	    drawTable();
	 } 
 function accept(bookingId, careId){
	 var parameters ="operation=accept&bookingId="+bookingId+"&careId="+careId;
	    $.get("http://localhost:8080/projectTest/booking?"+parameters, function(data, status){
	           
	    });
	    drawTable();
 }
 
 function cancel(bookingId, userType){
	
	 var parameters ="operation=cancel&bookingId="+bookingId+"&userType="+userType;
	// alert(parameters);
	    $.get("http://localhost:8080/projectTest/booking?"+parameters, function(data, status){
	           
	    });
	    drawTable();
 }
 
 drawTable();
</script>